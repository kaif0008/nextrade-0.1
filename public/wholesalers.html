<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wholesalers | NexTrade</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Open+Sans:wght@400;600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/wholesalers.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <!-- Header (Consistent with index.html) -->
    <header>
        <div class="container header-container">
            <a href="index.html" class="logo">
                <div class="logo-icon">
                    <i class="fas fa-arrow-trend-up"></i>
                </div>
                <div>
                    <div class="logo-text">Nex<span>Trade</span></div>
                    <div class="tagline">The Nexus of efficient Business</div>
                </div>
            </a>

            <nav>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="wholesalers.html" class="active">Wholesalers</a></li>
                    <li><a href="contact.html">Contact Us</a></li>
                    <li><a href="login.html" class="btn-login" id="loginBtn">Login</a></li>
                    <li><a href="signup.html" class="btn-nav btn-signup" id="signupBtn">Sign Up</a></li>
                    <li><a href="dashboard.html" id="dashboardBtn" style="display:none;">Dashboard</a></li>

                </ul>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="wholesalers-container">
        <div class="container">
            <!-- Page Header with Gradient Text -->
            <div class="page-header">
                <h1>Verified Wholesalers</h1>
                <div class="results-count">Showing <span id="totalResults">127</span> results</div>
            </div>

            <!-- Enhanced Filters Section -->
            <div class="filters-section">
                <div class="search-filter">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="Search wholesalers or products...">
                </div>

                <div class="filter-group">
                    <label for="categoryFilter"><i class="fas fa-tags"></i> Category</label>
                    <select id="categoryFilter">
                        <option value="">All Categories</option>
                        <option value="electronics">Electronics</option>
                        <option value="apparel">Apparel</option>
                        <option value="groceries">Groceries</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="locationFilter"><i class="fas fa-map-marker-alt"></i> Location</label>
                    <select id="locationFilter">
                        <option value="">All Locations</option>
                        <option value="delhi">Delhi NCR</option>
                        <option value="mumbai">Mumbai</option>
                        <option value="bangalore">Bangalore</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="sortBy"><i class="fas fa-sort-amount-down"></i> Sort By</label>
                    <select id="sortBy">
                        <option value="rating">Highest Rated</option>
                        <option value="verified">Verified First</option>
                        <option value="min-order">Lowest MOQ</option>
                    </select>
                </div>
            </div>

            <!-- Wholesalers Grid -->
            <div class="wholesalers-grid" id="wholesalersGrid">
                <!-- Cards will be populated by JavaScript -->
                <div class="wholesaler-card">
                    <div class="verified-badge">
                        <i class="fas fa-check-circle"></i> Verified
                    </div>
                    <div class="wholesaler-image"
                        style="background-image: url('https://images.unsplash.com/photo-1600880292203-757bb62b4baf?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80')">
                    </div>
                    <div class="wholesaler-info">
                        <h3>Global Electronics</h3>
                        <div class="rating">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star-half-alt"></i>
                            <span>4.7 (128 reviews)</span>
                        </div>
                        <div class="meta-info">
                            <div class="location">
                                <i class="fas fa-map-marker-alt"></i> Delhi NCR
                            </div>
                            <div class="min-order">
                                <i class="fas fa-shopping-bag"></i> Min. Order: ₹5,000
                            </div>
                        </div>
                        <div class="categories">
                            <span class="category-tag">Electronics</span>
                            <span class="category-tag">Gadgets</span>
                        </div>
                    </div>
                    <div class="wholesaler-actions">
                        <a href="items.html" class="btn btn-outline">
                            <i class="fas fa-store"></i> View Profile
                        </a>
                        <button class="btn btn-primary contact-btn">
                            <i class="fas fa-envelope"></i> Message
                        </button>
                    </div>
                </div>
            </div>

            <!-- Pagination -->
            <div class="pagination">
                <button class="btn-pagination" disabled>
                    <i class="fas fa-chevron-left"></i> Previous
                </button>
                <div class="page-numbers">
                    <span class="active">1</span>
                    <span>2</span>
                    <span>3</span>
                    <span>...</span>
                    <span>8</span>
                </div>
                <button class="btn-pagination">
                    Next <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>
    </main>

    <!-- <script src="js/wholesalers.js"></script> -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // DOM Elements
            const searchInput = document.getElementById('searchInput');
            const locationFilter = document.getElementById('locationFilter');
            const categoryFilter = document.getElementById('categoryFilter');
            const sortBy = document.getElementById('sortBy');
            const wholesalersGrid = document.getElementById('wholesalersGrid');
            const totalResults = document.getElementById('totalResults');
            const prevPageBtn = document.querySelector('.pagination .btn-pagination:first-child');
            const nextPageBtn = document.querySelector('.pagination .btn-pagination:last-child');
            const pageNumbers = document.querySelector('.page-numbers');

            // App State
            const state = {
                currentPage: 1,
                itemsPerPage: 9,
                filteredWholesalers: [],
                allWholesalers: []
            };

            // Initialize the app
            async function init() {
                try {
                    // In production: Replace with actual API call
                    // const response = await fetch('/api/wholesalers');
                    // state.allWholesalers = await response.json();

                    // For demo: Load sample data
                    loadSampleData();
                    state.filteredWholesalers = [...state.allWholesalers];

                    renderWholesalers();
                    setupEventListeners();
                } catch (error) {
                    console.error('Error initializing:', error);
                    showError('Failed to load wholesalers. Please try again later.');
                }
            }

            // Event Listeners
            function setupEventListeners() {
                // Filtering
                searchInput.addEventListener('input', debounce(filterWholesalers, 300));
                locationFilter.addEventListener('change', filterWholesalers);
                categoryFilter.addEventListener('change', filterWholesalers);
                sortBy.addEventListener('change', filterWholesalers);

                // Pagination
                prevPageBtn.addEventListener('click', goToPreviousPage);
                nextPageBtn.addEventListener('click', goToNextPage);

                // Event delegation for dynamic elements
                wholesalersGrid.addEventListener('click', handleCardClick);
                pageNumbers.addEventListener('click', handlePageNumberClick);
            }

            // Filtering Logic
            function filterWholesalers() {
                const searchTerm = searchInput.value.toLowerCase();
                const location = locationFilter.value;
                const category = categoryFilter.value;
                const sortValue = sortBy.value;

                state.filteredWholesalers = [...state.allWholesalers];

                // Apply filters
                if (searchTerm) {
                    state.filteredWholesalers = state.filteredWholesalers.filter(ws =>
                        ws.name.toLowerCase().includes(searchTerm) ||
                        ws.description.toLowerCase().includes(searchTerm) ||
                        ws.categories.some(cat => cat.includes(searchTerm))
                    );
                }

                if (location) {
                    state.filteredWholesalers = state.filteredWholesalers.filter(ws => ws.location === location);
                }

                if (category) {
                    state.filteredWholesalers = state.filteredWholesalers.filter(ws =>
                        ws.categories.includes(category)
                    );
                }

                // Apply sorting
                sortWholesalers(sortValue);

                // Reset to first page
                state.currentPage = 1;
                renderWholesalers();
            }

            // Sorting Logic
            function sortWholesalers(sortValue) {
                switch (sortValue) {
                    case 'rating':
                        state.filteredWholesalers.sort((a, b) => b.rating - a.rating);
                        break;
                    case 'newest':
                        state.filteredWholesalers.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                        break;
                    case 'min-order':
                        state.filteredWholesalers.sort((a, b) => a.minOrder - b.minOrder);
                        break;
                    default:
                        state.filteredWholesalers.sort((a, b) => a.id - b.id);
                }
            }

            // Pagination Logic
            function goToPreviousPage() {
                if (state.currentPage > 1) {
                    state.currentPage--;
                    renderWholesalers();
                }
            }

            function goToNextPage() {
                const totalPages = Math.ceil(state.filteredWholesalers.length / state.itemsPerPage);
                if (state.currentPage < totalPages) {
                    state.currentPage++;
                    renderWholesalers();
                }
            }

            function handlePageNumberClick(e) {
                if (e.target.classList.contains('page-number')) {
                    state.currentPage = parseInt(e.target.dataset.page);
                    renderWholesalers();
                }
            }

            // Rendering
            function renderWholesalers() {
                const startIdx = (state.currentPage - 1) * state.itemsPerPage;
                const endIdx = startIdx + state.itemsPerPage;
                const paginatedWholesalers = state.filteredWholesalers.slice(startIdx, endIdx);

                renderWholesalerCards(paginatedWholesalers);
                renderPagination();
                updateResultsCount();
            }

            function renderWholesalerCards(wholesalers) {
                wholesalersGrid.innerHTML = '';

                if (wholesalers.length === 0) {
                    wholesalersGrid.innerHTML = `
                <div class="no-results">
                    <i class="fas fa-search"></i>
                    <h3>No wholesalers found</h3>
                    <p>Try adjusting your search filters</p>
                </div>
            `;
                    return;
                }

                wholesalers.forEach(ws => {
                    const card = document.createElement('div');
                    card.className = 'wholesaler-card';
                    card.dataset.id = ws.id;
                    card.innerHTML = `
                ${ws.verified ? `
                <div class="verified-badge">
                    <i class="fas fa-check-circle"></i> Verified
                </div>` : ''}
                <div class="wholesaler-image" style="background-image: url('${ws.image}')">
                </div>
                <div class="wholesaler-info">
                    <h3>${ws.name}</h3>
                    <div class="rating">
                        ${generateStarRating(ws.rating)}
                        <span>${ws.rating} (${ws.reviews})</span>
                    </div>
                    <div class="location">
                        <i class="fas fa-map-marker-alt"></i> ${formatLocation(ws.location)}
                    </div>
                    <div class="min-order">
                        <i class="fas fa-box"></i> Min. Order: ₹${ws.minOrder.toLocaleString()}
                    </div>
                    <div class="categories">
                        ${ws.categories.map(cat => `
                            <span class="category-tag">${formatCategory(cat)}</span>
                        `).join('')}
                    </div>
                </div>
                <div class="wholesaler-actions">
                    <button class="btn btn-outline view-store" data-id="${ws.id}">
                        <i class="fas fa-store"></i> View Store
                    </button>
                    <button class="btn btn-primary contact-btn" data-id="${ws.id}">
                        <i class="fas fa-envelope"></i> Contact
                    </button>
                </div>
            `;
                    wholesalersGrid.appendChild(card);
                });
            }

            function renderPagination() {
                const totalPages = Math.ceil(state.filteredWholesalers.length / state.itemsPerPage);

                // Update button states
                prevPageBtn.disabled = state.currentPage === 1;
                nextPageBtn.disabled = state.currentPage === totalPages;

                // Generate page numbers
                pageNumbers.innerHTML = '';
                const maxVisiblePages = 5;
                let startPage, endPage;

                if (totalPages <= maxVisiblePages) {
                    startPage = 1;
                    endPage = totalPages;
                } else {
                    const maxPagesBeforeCurrent = Math.floor(maxVisiblePages / 2);
                    const maxPagesAfterCurrent = Math.ceil(maxVisiblePages / 2) - 1;

                    if (state.currentPage <= maxPagesBeforeCurrent) {
                        startPage = 1;
                        endPage = maxVisiblePages;
                    } else if (state.currentPage + maxPagesAfterCurrent >= totalPages) {
                        startPage = totalPages - maxVisiblePages + 1;
                        endPage = totalPages;
                    } else {
                        startPage = state.currentPage - maxPagesBeforeCurrent;
                        endPage = state.currentPage + maxPagesAfterCurrent;
                    }
                }

                // Add first page and ellipsis if needed
                if (startPage > 1) {
                    addPageNumber(1);
                    if (startPage > 2) {
                        pageNumbers.innerHTML += '<span class="ellipsis">...</span>';
                    }
                }

                // Add page numbers
                for (let i = startPage; i <= endPage; i++) {
                    addPageNumber(i);
                }

                // Add last page and ellipsis if needed
                if (endPage < totalPages) {
                    if (endPage < totalPages - 1) {
                        pageNumbers.innerHTML += '<span class="ellipsis">...</span>';
                    }
                    addPageNumber(totalPages);
                }
            }

            function addPageNumber(page) {
                const pageElement = document.createElement('span');
                pageElement.textContent = page;
                pageElement.dataset.page = page;
                pageElement.classList.add('page-number');

                if (page === state.currentPage) {
                    pageElement.classList.add('active');
                }

                pageNumbers.appendChild(pageElement);
            }

            function updateResultsCount() {
                totalResults.textContent = state.filteredWholesalers.length;
            }

            // Event Handlers
            function handleCardClick(e) {
                const viewStoreBtn = e.target.closest('.view-store');
                const contactBtn = e.target.closest('.contact-btn');

                if (viewStoreBtn) {
                    const wholesalerId = viewStoreBtn.dataset.id;
                    window.location.href = `items.html?id=${wholesalerId}`;
                }

                if (contactBtn) {
                    const wholesalerId = contactBtn.dataset.id;
                    initiateContact(wholesalerId);
                }
            }

            async function initiateContact(wholesalerId) {
                try {
                    // In production: Check if user is logged in first
                    // const wholesaler = state.allWholesalers.find(ws => ws.id == wholesalerId);
                    // Open contact modal or redirect to messaging page
                    console.log(`Initiating contact with wholesaler ${wholesalerId}`);

                    // Example: Show a contact modal
                    showContactModal(wholesalerId);
                } catch (error) {
                    console.error('Contact error:', error);
                    showError('Failed to initiate contact. Please try again.');
                }
            }

            // Helper Functions
            function generateStarRating(rating) {
                let stars = '';
                const fullStars = Math.floor(rating);
                const hasHalfStar = rating % 1 >= 0.5;

                for (let i = 0; i < fullStars; i++) {
                    stars += '<i class="fas fa-star"></i>';
                }

                if (hasHalfStar) {
                    stars += '<i class="fas fa-star-half-alt"></i>';
                }

                const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
                for (let i = 0; i < emptyStars; i++) {
                    stars += '<i class="far fa-star"></i>';
                }

                return stars;
            }

            function formatLocation(location) {
                const locations = {
                    'new-york': 'New York, NY',
                    'los-angeles': 'Los Angeles, CA',
                    'chicago': 'Chicago, IL',
                    'houston': 'Houston, TX',
                    'delhi': 'Delhi, India',
                    'mumbai': 'Mumbai, India',
                    'bangalore': 'Bangalore, India'
                };
                return locations[location] || location;
            }

            function formatCategory(category) {
                return category.split('-').map(word =>
                    word.charAt(0).toUpperCase() + word.slice(1)
                ).join(' ');
            }

            function debounce(func, wait) {
                let timeout;
                return function (...args) {
                    clearTimeout(timeout);
                    timeout = setTimeout(() => func.apply(this, args), wait);
                };
            }

            function showError(message) {
                // Implement error display logic
                console.error(message);
            }

            function showContactModal(wholesalerId) {
                // Implement modal display logic
                console.log(`Showing contact modal for wholesaler ${wholesalerId}`);
            }

            // Sample Data Generation
            function loadSampleData() {
                const sampleCategories = [
                    ['electronics', 'gadgets'],
                    ['clothing', 'fashion'],
                    ['groceries', 'organic'],
                    ['home-goods', 'furniture'],
                    ['beauty', 'skincare'],
                    ['toys', 'games']
                ];

                const sampleLocations = ['new-york', 'los-angeles', 'chicago', 'houston', 'delhi', 'mumbai', 'bangalore'];

                const sampleDescriptions = [
                    "Leading supplier of quality products with 10+ years experience",
                    "Family-owned business providing premium goods at wholesale prices",
                    "Sustainable and eco-friendly products for conscious retailers",
                    "Fast shipping and reliable inventory management"
                ];

                for (let i = 1; i <= 25; i++) {
                    const randomCategories = sampleCategories[Math.floor(Math.random() * sampleCategories.length)];
                    state.allWholesalers.push({
                        id: i,
                        name: `Wholesaler ${i}`,
                        description: sampleDescriptions[Math.floor(Math.random() * sampleDescriptions.length)],
                        rating: parseFloat((Math.random() * 2 + 3).toFixed(1)),
                        reviews: Math.floor(Math.random() * 200),
                        location: sampleLocations[Math.floor(Math.random() * sampleLocations.length)],
                        minOrder: Math.floor(Math.random() * 2000) + 100,
                        categories: randomCategories,
                        image: `https://picsum.photos/500/300?random=${i}`,
                        verified: Math.random() > 0.3,
                        createdAt: new Date(Date.now() - Math.floor(Math.random() * 1000 * 60 * 60 * 24 * 365))
                    });
                }
            }

            // Initialize the application
            init();
        });
    </script>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const user = JSON.parse(localStorage.getItem("user"));
            const token = localStorage.getItem("token");

            const loginBtn = document.getElementById("loginBtn");
            const signupBtn = document.getElementById("signupBtn");
            const dashboardBtn = document.getElementById("dashboardBtn");

            if (user && token) {
                // Logged-in user
                if (loginBtn) loginBtn.style.display = "none";
                if (signupBtn) signupBtn.style.display = "none";
                if (dashboardBtn) dashboardBtn.style.display = "inline-block";
            } else {
                // Guest user
                if (loginBtn) loginBtn.style.display = "inline-block";
                if (signupBtn) signupBtn.style.display = "inline-block";
                if (dashboardBtn) dashboardBtn.style.display = "none";
            }
        });
    </script>


</body>

</html>