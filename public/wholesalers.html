<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wholesalers | NexTrade</title>

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/wholesalers.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>

<!-- ================= HEADER ================= -->
<header>
    <div class="container header-container">
        <a href="index.html" class="logo">
            <div class="logo-icon"><i class="fas fa-arrow-trend-up"></i></div>
            <div>
                <div class="logo-text">Nex<span>Trade</span></div>
                <div class="tagline">The Nexus of efficient Business</div>
            </div>
        </a>

        <nav>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="wholesalers.html" class="active">Wholesalers</a></li>
                <li><a href="contact.html">Contact Us</a></li>

                <li><a href="login.html" id="loginBtn" class="btn-login">Login</a></li>
                <li><a href="signup.html" id="signupBtn" class="btn-nav btn-signup">Sign Up</a></li>
                <li><a href="dashboard.html" id="dashboardBtn" style="display:none;">Dashboard</a></li>
            </ul>
        </nav>
    </div>
</header>

<!-- ================= MAIN ================= -->
<main class="wholesalers-container">
    <div class="container">

        <div class="page-header">
            <h1>Registered Wholesalers</h1>
            <div class="results-count">
                Showing <span id="totalResults">0</span> results
            </div>
        </div>

        <!-- Filters -->
        <div class="filters-section">
            <div class="search-filter">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" placeholder="Search by name or email">
            </div>

            <div class="filter-group">
                <label>Sort By</label>
                <select id="sortBy">
                    <option value="name">Name</option>
                    <option value="newest">Newest</option>
                </select>
            </div>
        </div>

        <!-- Grid -->
        <div class="wholesalers-grid" id="wholesalersGrid"></div>

        <!-- Pagination -->
        <div class="pagination">
            <button class="btn-pagination" id="prevBtn">Previous</button>
            <div class="page-numbers" id="pageNumbers"></div>
            <button class="btn-pagination" id="nextBtn">Next</button>
        </div>

    </div>
</main>

<!-- ================= SCRIPT ================= -->
<script>
document.addEventListener("DOMContentLoaded", async () => {

    const grid = document.getElementById("wholesalersGrid");
    const totalResults = document.getElementById("totalResults");
    const searchInput = document.getElementById("searchInput");
    const sortBy = document.getElementById("sortBy");

    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const pageNumbers = document.getElementById("pageNumbers");

    const state = {
        all: [],
        filtered: [],
        page: 1,
        perPage: 6
    };

    /* ===== FETCH REAL WHOLESALERS ===== */
    async function loadWholesalers() {
        const res = await fetch("/api/wholesalers");
        const data = await res.json();

        if (!data.success) {
            grid.innerHTML = "<p>Failed to load wholesalers</p>";
            return;
        }

        state.all = data.wholesalers;
        state.filtered = [...state.all];
        render();
    }

    /* ===== FILTER & SORT ===== */
    function applyFilters() {
        const term = searchInput.value.toLowerCase();

        state.filtered = state.all.filter(w =>
            (w.name && w.name.toLowerCase().includes(term)) ||
            (w.businessName && w.businessName.toLowerCase().includes(term)) ||
            (w.email && w.email.toLowerCase().includes(term))
        );

        if (sortBy.value === "newest") {
            state.filtered.sort((a,b) => new Date(b.createdAt) - new Date(a.createdAt));
        } else {
            state.filtered.sort((a,b) => a.name.localeCompare(b.name));
        }

        state.page = 1;
        render();
    }

    /* ===== RENDER ===== */
    function render() {
        grid.innerHTML = "";

        const start = (state.page - 1) * state.perPage;
        const end = start + state.perPage;
        const items = state.filtered.slice(start, end);

        totalResults.textContent = state.filtered.length;

        if (!items.length) {
            grid.innerHTML = "<p>No wholesalers found</p>";
            return;
        }

        items.forEach(w => {
            grid.innerHTML += `
                <div class="wholesaler-card">
                    <div class="wholesaler-image"
                         style="background-image:url('images/default-wholesaler.jpg')">
                    </div>

                    <div class="wholesaler-info">
                        <h3>${w.businessName || w.name}</h3>
                        <p><i class="fas fa-envelope"></i> ${w.email}</p>
                        <p><i class="fas fa-map-marker-alt"></i> ${w.address || "India"}</p>
                    </div>

                    <div class="wholesaler-actions">
                        <button class="btn btn-outline"
                            onclick="location.href='items.html?id=${w._id}'">
                            View Products
                        </button>
                    </div>
                </div>
            `;
        });

        renderPagination();
    }

    /* ===== PAGINATION ===== */
    function renderPagination() {
        pageNumbers.innerHTML = "";
        const pages = Math.ceil(state.filtered.length / state.perPage);

        prevBtn.disabled = state.page === 1;
        nextBtn.disabled = state.page === pages;

        for (let i = 1; i <= pages; i++) {
            const span = document.createElement("span");
            span.textContent = i;
            if (i === state.page) span.classList.add("active");
            span.onclick = () => { state.page = i; render(); };
            pageNumbers.appendChild(span);
        }
    }

    prevBtn.onclick = () => { state.page--; render(); };
    nextBtn.onclick = () => { state.page++; render(); };

    searchInput.addEventListener("input", applyFilters);
    sortBy.addEventListener("change", applyFilters);

    loadWholesalers();
});
</script>

<!-- ===== NAV AUTH TOGGLE ===== -->
<script>
document.addEventListener("DOMContentLoaded", () => {
    const user = JSON.parse(localStorage.getItem("user"));
    const token = localStorage.getItem("token");

    document.getElementById("loginBtn").style.display = user ? "none" : "inline-block";
    document.getElementById("signupBtn").style.display = user ? "none" : "inline-block";
    document.getElementById("dashboardBtn").style.display = user ? "inline-block" : "none";
});
</script>

</body>
</html>
